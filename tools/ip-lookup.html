<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Address Lookup & Geolocation | toolsTree</title>
    <meta name="description" content="Get detailed IP geolocation, network, security (proxy/VPN), and timezone data for any IP address or domain. Find your IP instantly.">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="canonical" href="https://toolstree.vercel.app/tools/ip-lookup.html">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link href="../assets/output.css" rel="stylesheet">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N1KEVGM2VP"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-N1KEVGM2VP');
    </script>
    <script>
      (function() {
        try {
          const theme = localStorage.getItem('theme');
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          if (theme === 'dark' || (!theme && prefersDark)) {
            document.documentElement.classList.add('dark');
          }
        } catch (e) { console.error("Error applying initial theme:", e); }
      })();
    </script>
    <script> window.GLOBAL_ROOT_PATH = '../'; </script>
    <script src="https://unpkg.com/lucide@latest" defer></script>

    <!-- Leaflet.js for the interactive map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        :root { --tt-primary-stroke: #10b981; }
        .stroke-tt-primary { stroke: var(--tt-primary-stroke); }
        .dark input, .dark select, .dark textarea { background-color: #374151; border-color: #4b5563; color: #f3f4f6; }

        /* Map styles */
        #map { height: 350px; border-radius: 0.5rem; z-index: 10; }
        .dark #map { filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%); }

        /* Key-value table style for results */
        .result-grid { display: grid; grid-template-columns: auto 1fr; gap: 0.75rem 1rem; font-size: 0.875rem; }
        .result-grid dt { font-weight: 600; color: #4b5563; }
        .dark .result-grid dt { color: #d1d5db; }
        .result-grid dd { font-family: 'Roboto Mono', monospace; color: #1f2937; word-break: break-all; display: flex; justify-content: space-between; align-items: center; gap: 0.5rem; }
        .dark .result-grid dd { color: #f3f4f6; }
        .copy-btn { opacity: 0; padding: 0.25rem; border-radius: 0.25rem; color: #6b7280; transition: opacity 0.2s ease, color 0.2s ease; flex-shrink: 0; cursor: pointer; }
        .dark .copy-btn { color: #9ca3af; }
        .result-grid dd:hover .copy-btn { opacity: 1; color: #10b981; }

        .tab-btn { padding: 0.5rem 1rem; font-weight: 600; border-radius: 0.375rem; border: 2px solid transparent; transition: all 0.2s ease-in-out; cursor: pointer; } /* Added cursor */
        .tab-btn[aria-selected="true"] { background-color: #ecfdf5; color: #065f46; border-color: #10b981; }
        .dark .tab-btn[aria-selected="true"] { background-color: #064e3b; color: #a7f3d0; border-color: #10b981; }
        .dark .tab-btn { color: #d1d5db; }

        /* Custom Leaflet Zoom Icons */
        .leaflet-control-zoom a { background-color: transparent !important; border: none !important; background-repeat: no-repeat; background-position: center; width: 30px !important; height: 30px !important; transition: all 0.2s ease; }
        .leaflet-control-zoom a:hover { background-color: rgba(0, 0, 0, 0.05) !important; }
        .dark .leaflet-control-zoom a:hover { background-color: rgba(255, 255, 255, 0.1) !important; }
        .leaflet-control-zoom-in, .leaflet-control-zoom-out { text-indent: -9999px; }
        .leaflet-control-zoom-in { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%231f2937' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='11' y1='8' x2='11' y2='14'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E") !important; opacity: 0.8; }
        .leaflet-control-zoom-out { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%231f2937' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E") !important; opacity: 0.8; }
        .dark .leaflet-control-zoom-in { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23f3f4f6' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='11' y1='8' x2='11' y2='14'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E") !important; }
        .dark .leaflet-control-zoom-out { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23f3f4f6' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E") !important; }
        .leaflet-touch .leaflet-control-zoom a { width: 34px !important; height: 34px !important; }

        /* DNS Results Styling */
        .dns-record-group { margin-bottom: 0.75rem; }
        .dns-record-group h4 { font-weight: 600; font-size: 0.875rem; color: #1f2937; margin-bottom: 0.25rem; }
        .dark .dns-record-group h4 { color: #f3f4f6; }
        .dns-record-list { font-family: 'Roboto Mono', monospace; font-size: 0.875rem; list-style-type: none; padding: 0.5rem; background-color: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; word-break: break-all; }
        .dark .dns-record-list { background-color: #374151; border-color: #4b5563; }
        .dns-record-list li { padding: 0.25rem 0.5rem; }
        .dns-record-list li:not(:last-child) { border-bottom: 1px dashed #d1d5db; }
        .dark .dns-record-list li:not(:last-child) { border-bottom-color: #4b5563; }
    </style>

    <!-- ... (LD+JSON Schema and FAQ Schema unchanged) ... -->
     <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "IP Address Lookup & Geolocation",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web",
      "description": "Get detailed IP geolocation, network, security (proxy/VPN), and timezone data for any IP address or domain. Find your IP instantly.",
      "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"},
      "aggregateRating": {"@type": "AggregateRating", "ratingValue": "4.8", "reviewCount": "320"},
      "publisher": {"@type": "Organization", "name": "toolsTree"}
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "How accurate is IP geolocation?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "IP geolocation accuracy varies. It is highly accurate at the country level (99%+). It is generally good at the region/state level (80-90%) and city level (60-80%). It is *not* accurate at a street or postal code level. The location shown is typically the center of the city or the location of the ISP's data center, not your physical home address."
          }
        },
        {
          "@type": "Question",
          "name": "Why does my IP location show a different city?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "This is very common. Your IP address is assigned by your Internet Service Provider (ISP). The location associated with your IP is often the central processing office or 'hub' for your ISP in your region, which may be in a different city or town than your actual location."
          }
        },
        {
          "@type": "Question",
          "name": "Can this tool detect a VPN or Proxy?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. This tool checks the IP address against known databases of public proxies, VPN exit nodes, and web hosting/data center IP ranges. The 'Security' tab will show 'true' if the IP is flagged as a proxy or hosting service, which is a strong indicator of a VPN or non-residential IP."
          }
        },
        {
          "@type": "Question",
          "name": "What is an 'ASN' or 'Organization'?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "ASN stands for 'Autonomous System Number.' It's a unique number that identifies a large network, like a major ISP (e.g., Comcast, AT&T), a cloud provider (e.g., Amazon Web Services, Google Cloud), or a large university. The 'Organization' is the registered owner of that ASN."
          }
        }
      ]
    }
    </script>
</head>
<body class="bg-gray-50 dark:bg-black text-gray-800 dark:text-gray-100 flex flex-col min-h-screen">

    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 flex-grow w-full">
        <!-- ... (Nav/Breadcrumb unchanged) ... -->
        <nav class="flex mb-6" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3 text-sm">
                <li class="inline-flex items-center"><a href="../index.html" class="hover:text-tt-primary"><i data-lucide="home" class="w-4 h-4 mr-2 inline"></i>Home</a></li>
                <li><div class="flex items-center"><i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i><a href="../categories/networking.html" class="ml-1 hover:text-tt-primary md:ml-2">Networking & Security Tools</a></div></li>
                <li aria-current="page"><div class="flex items-center"><i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i><span class="ml-1 font-medium text-tt-primary md:ml-2">IP Address Lookup & Geolocation</span></div></li>
            </ol>
        </nav>

        <!-- ... (Header unchanged) ... -->
        <section class="mb-10 text-center">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 dark:text-gray-100 mb-3">IP Address Lookup & Geolocation</h1>
            <p class="text-base text-gray-600 dark:text-gray-300">Get detailed geolocation, network, security, and timezone data for any IP or domain.</p>
        </section>

        <div class="bg-white dark:bg-gray-900 shadow-2xl rounded-xl p-6 sm:p-8 border border-gray-100 dark:border-gray-800">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Left Column: Input, Map -->
                <div class="space-y-6">
                    <!-- My IP Card -->
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border dark:border-gray-700">
                        <h2 class="text-lg font-bold mb-2 text-gray-900 dark:text-gray-100">Your IP Address</h2>
                        <div id="my-ip-loading" class="flex items-center space-x-2 text-gray-500">
                            <i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>
                            <span>Fetching your IP...</span>
                        </div>
                        <div id="my-ip-content" class="hidden">
                            <p class="font-mono text-xl font-bold text-tt-primary" id="my-ip-address"></p>
                            <p class="text-sm text-gray-600 dark:text-gray-300" id="my-ip-location"></p>
                        </div>
                    </div>

                    <!-- Lookup Card -->
                    <div>
                        <label for="ipInput" class="block text-lg font-semibold mb-2">Lookup any IP or Domain</label>
                        <div class="flex gap-2">
                            <input type="text" id="ipInput" placeholder="e.g., 8.8.8.8 or google.com" class="w-full p-3 border rounded-lg shadow-sm font-mono">
                            <button id="lookupBtn" class="flex items-center justify-center space-x-2 bg-tt-primary hover:bg-green-700 text-white font-bold py-3 px-5 rounded-lg shadow-md transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                <!-- Added loading spinner elements -->
                                <span id="lookup-spinner" class="hidden animate-spin rounded-full h-5 w-5 border-b-2 border-white"></span>
                                <i id="lookup-icon" data-lucide="search" class="w-5 h-5 flex-shrink-0"></i>
                                <span id="lookup-text">Lookup</span>
                            </button>
                        </div>
                         <div id="input-error" class="text-red-500 text-sm mt-1 hidden">Invalid IP or Domain format.</div>
                    </div>

                    <!-- Map Card -->
                    <div>
                        <h2 class="text-lg font-semibold mb-2">Geolocation Map</h2>
                        <div id="map-container" class="relative bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden">
                            <div id="map"></div>
                            <div id="map-placeholder" class="absolute inset-0 flex items-center justify-center z-20 bg-gray-100 dark:bg-gray-800 bg-opacity-80 dark:bg-opacity-80">
                                <p class="text-gray-600 dark:text-gray-300">Map will be shown after lookup</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Results -->
                <div class="space-y-4">
                    <h2 class="text-lg font-semibold mb-2">Lookup Results</h2>
                    <div id="results-card" class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border dark:border-gray-700 min-h-[400px]">

                        <!-- Placeholder -->
                        <div id="results-placeholder" class="flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400">
                            <i data-lucide="file-search" class="w-16 h-16 mb-4"></i>
                            <p class="font-semibold">Enter an IP or domain to begin</p>
                            <p class="text-sm">Your own IP will be loaded automatically.</p>
                        </div>

                        <!-- Loading Skeleton -->
                        <div id="results-loading" class="hidden animate-pulse space-y-4">
                             <div class="flex space-x-2">
                                <div class="h-8 bg-gray-300 dark:bg-gray-600 rounded-md w-1/4"></div>
                                <div class="h-8 bg-gray-300 dark:bg-gray-600 rounded-md w-1/4"></div>
                                <div class="h-8 bg-gray-300 dark:bg-gray-600 rounded-md w-1/4"></div>
                            </div>
                            <div class="space-y-3 pt-4">
                               <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-1/3"></div>
                               <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-1/2"></div>
                               <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-1/3"></div>
                               <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-1/2"></div>
                               <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-1/3"></div>
                            </div>
                        </div>

                        <!-- Error Message -->
                        <div id="results-error" class="hidden flex flex-col items-center justify-center h-full text-red-500 text-center">
                            <i data-lucide="alert-triangle" class="w-16 h-16 mb-4"></i>
                            <p class="font-semibold" id="error-message">An error occurred.</p>
                        </div>

                        <!-- Real Results -->
                        <div id="results-content" class="hidden">
                            <!-- Tab Buttons -->
                            <div class="flex flex-wrap gap-2 mb-4" role="tablist" aria-label="IP Details">
                                <button class="tab-btn" id="tab-geo" role="tab" aria-selected="true" aria-controls="panel-geo">Geolocation</button>
                                <button class="tab-btn" id="tab-network" role="tab" aria-selected="false" aria-controls="panel-network">Network</button>
                                <button class="tab-btn" id="tab-security" role="tab" aria-selected="false" aria-controls="panel-security">Security</button>
                                <button class="tab-btn" id="tab-timezone" role="tab" aria-selected="false" aria-controls="panel-timezone">Timezone</button>
                                <button class="tab-btn hidden" id="tab-whois" role="tab" aria-selected="false" aria-controls="panel-whois">WHOIS</button>
                                <button class="tab-btn hidden" id="tab-dns" role="tab" aria-selected="false" aria-controls="panel-dns">DNS Records</button>
                            </div>

                            <!-- Tab Panels -->
                            <div id="tab-panels">
                                <div id="panel-geo" role="tabpanel" aria-labelledby="tab-geo">
                                    <dl class="result-grid">
                                        <dt>IP Address</dt><dd><span id="res-query">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Country</dt><dd><span id="res-country">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Region</dt><dd><span id="res-region">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>City</dt><dd><span id="res-city">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Postal Code</dt><dd><span id="res-zip">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Latitude</dt><dd><span id="res-lat">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Longitude</dt><dd><span id="res-lon">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                    </dl>
                                </div>
                                <div id="panel-network" role="tabpanel" aria-labelledby="tab-network" class="hidden">
                                    <dl class="result-grid">
                                        <dt>ISP</dt><dd><span id="res-isp">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Organization</dt><dd><span id="res-org">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>ASN</dt><dd><span id="res-as">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Hostname</dt><dd><span id="res-hostname">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                    </dl>
                                </div>
                                <div id="panel-security" role="tabpanel" aria-labelledby="tab-security" class="hidden">
                                    <dl class="result-grid">
                                        <dt>Proxy</dt><dd><span id="res-proxy">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>VPN</dt><dd><span id="res-vpn">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Tor Node</dt><dd><span id="res-tor">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                    </dl>
                                </div>
                                <div id="panel-timezone" role="tabpanel" aria-labelledby="tab-timezone" class="hidden">
                                    <dl class="result-grid">
                                        <dt>Timezone</dt><dd><span id="res-timezone">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Local Time</dt><dd><span id="res-localtime">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                    </dl>
                                </div>
                                <div id="panel-whois" role="tabpanel" aria-labelledby="tab-whois" class="hidden">
                                    <dl class="result-grid">
                                        <dt>Registrar</dt><dd><span id="res-whois-registrar">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Registered On</dt><dd><span id="res-whois-registered">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                        <dt>Expires On</dt><dd><span id="res-whois-expires">N/A</span><button class="copy-btn" title="Copy"><i data-lucide="copy" class="w-4 h-4"></i></button></dd>
                                    </dl>
                                </div>
                                <div id="panel-dns" role="tabpanel" aria-labelledby="tab-dns" class="hidden">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ... (Informational sections unchanged) ... -->
        <section class="mt-8 bg-white p-6 rounded-xl shadow-lg dark:bg-gray-900 border border-gray-100 dark:border-gray-800 space-y-6">
            <div>
                <h2 class="text-2xl font-bold mb-3 text-gray-900 border-b pb-2 dark:text-gray-100 dark:border-gray-800">What is an IP Address?</h2>
                <div class="space-y-4 text-gray-700 dark:text-gray-300">
                    <p>An <strong>IP (Internet Protocol) address</strong> is a unique numerical label assigned to every device connected to a computer network that uses the Internet Protocol for communication. It serves two primary functions: identifying the host or network interface and providing the location of the host in the network (geolocation).</p>
                    <p>You'll encounter two main types of IP addresses:</p>
                    <ul class="list-disc list-inside space-y-1 ml-4">
                        <li><strong>IPv4:</strong> The older, more common format, consisting of four numbers separated by dots (e.g., `8.8.8.8`). This system supports about 4.3 billion unique addresses.</li>
                        <li><strong>IPv6:</strong> The newer format, designed to replace IPv4. It uses a much longer string of hexadecimal characters (e.g., `2001:4860:4860::8888`) and supports a virtually limitless number of addresses.</li>
                    </ul>
                    <p>Your "Public IP" (the one this tool shows) is the address your entire home or office network uses to communicate with the rest of the internet. It's assigned by your Internet Service Provider (ISP).</p>
                </div>
            </div>
            <div>
                <h2 class="text-2xl font-bold mb-3 text-gray-900 border-b pb-2 dark:text-gray-100 dark:border-gray-800">How Does IP Geolocation Work?</h2>
                <div class="space-y-4 text-gray-700 dark:text-gray-300">
                    <p>IP geolocation is the process of mapping an IP address to the real-world geographic location of a device. It's important to understand that this technology is <strong>not 100% accurate</strong> and does not provide your precise street address.</p>
                    <p>Hereâ€™s how it works:</p>
                    <ol class="list-decimal list-inside space-y-1 ml-4">
                        <li>ISPs are allocated large blocks of IP addresses by regional registries.</li>
                        <li>The ISP then assigns these IPs to its customers in various regions.</li>
                        <li>Geolocation database providers (like the one this tool uses) compile this information, linking IP ranges to the cities, regions, and countries where they are assigned.</li>
                        <li>When you look up an IP, the tool queries this database and returns the associated location data.</li>
                    </ol>
                    <p>The location shown is often the central "Point of Presence" (PoP) or data center for your ISP in your region, which can be in a different city from your actual location. It's best used for identifying the country, state, and general city of a user, not their home address.</p>
                </div>
            </div>
            <div>
                <h2 class="text-2xl font-bold mb-3 text-gray-900 border-b pb-2 dark:text-gray-100 dark:border-gray-800">Understanding the Data</h2>
                <div class="space-y-4 text-gray-700 dark:text-gray-300">
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li><strong>ISP (Internet Service Provider):</strong> The company that provides your internet access (e.g., Comcast, AT&T, Spectrum).</li>
                        <li><strong>ASN (Autonomous System Number):</strong> A unique number that identifies a large, independent network. The "Organization" is the registered owner of this ASN, which is usually the ISP or a large tech company (like Google or Amazon).</li>
                        <li><strong>Hostname (Reverse DNS):</strong> The human-readable name associated with an IP address (e.g., `google-public-dns-a.google.com`). This is the reverse of a normal DNS lookup.</li>
                        <li><strong>Proxy/VPN Detection:</strong> This feature checks the IP against known databases of public proxies, VPN exit nodes, and IPs belonging to data centers (hosting providers). If this is "true," it's highly likely the user is masking their true IP.</li>
                    </ul>
                </div>
            </div>
            <div>
                <h2 class="text-2xl font-bold mb-3 text-gray-900 border-b pb-2 dark:text-gray-100 dark:border-gray-800">Frequently Asked Questions (FAQ)</h2>
                <div class="space-y-3 text-sm">
                    <details class="group">
                        <summary class="flex justify-between items-center font-medium cursor-pointer p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <span>How accurate is IP geolocation?</span>
                            <span class="transition group-open:rotate-180"><i data-lucide="chevron-down" class="w-4 h-4"></i></span>
                        </summary>
                        <p class="text-gray-600 mt-2 p-2 dark:text-gray-300">IP geolocation accuracy varies. It is highly accurate at the country level (99%+). It is generally good at the region/state level (80-90%) and city level (60-80%). It is <strong>not</strong> accurate at a street or postal code level. The location shown is typically the center of the city or the location of the ISP's data center, not your physical home address.</p>
                    </details>
                    <details class="group">
                        <summary class="flex justify-between items-center font-medium cursor-pointer p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <span>Why does my IP location show a different city?</span>
                            <span class="transition group-open:rotate-180"><i data-lucide="chevron-down" class="w-4 h-4"></i></span>
                        </summary>
                        <p class="text-gray-600 mt-2 p-2 dark:text-gray-300">This is very common. Your IP address is assigned by your Internet Service Provider (ISP). The location associated with your IP is often the central processing office or 'hub' for your ISP in your region, which may be in a different city or town than your actual location.</p>
                    </details>
                    <details class="group">
                        <summary class="flex justify-between items-center font-medium cursor-pointer p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <span>Can this tool detect a VPN or Proxy?</span>
                            <span class="transition group-open:rotate-180"><i data-lucide="chevron-down" class="w-4 h-4"></i></span>
                        </summary>
                        <p class="text-gray-600 mt-2 p-2 dark:text-gray-300">Yes. This tool checks the IP address against known databases of public proxies, VPN exit nodes, and web hosting/data center IP ranges. The 'Security' tab will show 'true' if the IP is flagged as a proxy or hosting service, which is a strong indicator of a VPN or non-residential IP.</p>
                    </details>
                    <details class="group">
                        <summary class="flex justify-between items-center font-medium cursor-pointer p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <span>What is an 'ASN' or 'Organization'?</span>
                            <span class="transition group-open:rotate-180"><i data-lucide="chevron-down" class="w-4 h-4"></i></span>
                        </summary>
                        <p class="text-gray-600 mt-2 p-2 dark:text-gray-300">ASN stands for 'Autonomous System Number.' It's a unique number that identifies a large, independent network, like a major ISP (e.g., Comcast, AT&T), a cloud provider (e.g., Amazon Web Services, Google Cloud), or a large university. The 'Organization' is the registered owner of that ASN.</p>
                    </details>
                </div>
            </div>
        </section>
    </main>

    <script src="../javascript/globals.js" defer></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof window.injectLayout === 'function') {
            window.injectLayout(false);
        } else {
            console.warn('`injectLayout` function not found. Header/footer will not be injected.');
        }

        // Render initial icons if Lucide is ready
        if (window.lucide) {
            lucide.createIcons();
        }

        // --- UI Elements ---
        const ui = {
            myIp: {
                loading: document.getElementById('my-ip-loading'),
                content: document.getElementById('my-ip-content'),
                address: document.getElementById('my-ip-address'),
                location: document.getElementById('my-ip-location'),
            },
            lookup: {
                input: document.getElementById('ipInput'),
                button: document.getElementById('lookupBtn'),
                spinner: document.getElementById('lookup-spinner'),
                icon: document.getElementById('lookup-icon'),
                text: document.getElementById('lookup-text'),
                inputError: document.getElementById('input-error'),
            },
            map: {
                container: document.getElementById('map'),
                placeholder: document.getElementById('map-placeholder'),
            },
            results: {
                card: document.getElementById('results-card'),
                placeholder: document.getElementById('results-placeholder'),
                loading: document.getElementById('results-loading'),
                error: document.getElementById('results-error'),
                errorMessage: document.getElementById('error-message'),
                content: document.getElementById('results-content'),
                tabs: document.querySelectorAll('[role="tab"]'), // Query all tabs initially
                panels: document.querySelectorAll('[role="tabpanel"]'), // Query all panels initially
                tabWhois: document.getElementById('tab-whois'),
                tabDns: document.getElementById('tab-dns'),
                panelWhois: document.getElementById('panel-whois'),
                panelDns: document.getElementById('panel-dns'),
            },
            res: { // All result spans
                query: document.getElementById('res-query'), country: document.getElementById('res-country'),
                region: document.getElementById('res-region'), city: document.getElementById('res-city'),
                zip: document.getElementById('res-zip'), lat: document.getElementById('res-lat'),
                lon: document.getElementById('res-lon'), isp: document.getElementById('res-isp'),
                org: document.getElementById('res-org'), as: document.getElementById('res-as'),
                hostname: document.getElementById('res-hostname'), proxy: document.getElementById('res-proxy'),
                vpn: document.getElementById('res-vpn'), tor: document.getElementById('res-tor'),
                timezone: document.getElementById('res-timezone'), localtime: document.getElementById('res-localtime'),
                whoisRegistrar: document.getElementById('res-whois-registrar'),
                whoisRegistered: document.getElementById('res-whois-registered'),
                whoisExpires: document.getElementById('res-whois-expires'),
            }
        };

        // --- Map Initialization ---
        let map;
        let mapMarker;
        try {
            // Check if Leaflet is loaded
            if (typeof L !== 'undefined') {
                map = L.map(ui.map.container).setView([20.5937, 78.9629], 3);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
            } else {
                throw new Error("Leaflet library not loaded.");
            }
        } catch (e) {
            console.error("Failed to initialize map:", e);
            ui.map.container.innerHTML = `<div class="absolute inset-0 flex items-center justify-center bg-gray-200 dark:bg-gray-700"><p class="p-4 text-red-500">Error: Could not load map library.</p></div>`;
            ui.map.placeholder.classList.add('hidden'); // Hide placeholder if map init fails
        }

        // --- State Management ---
        const showMyIpLoading = (isLoading) => {
            ui.myIp.loading.classList.toggle('hidden', !isLoading);
            ui.myIp.content.classList.toggle('hidden', isLoading);
        };

        const showResultState = (state) => {
            ui.results.placeholder.classList.toggle('hidden', state !== 'placeholder');
            ui.results.loading.classList.toggle('hidden', state !== 'loading');
            ui.results.error.classList.toggle('hidden', state !== 'error');
            ui.results.content.classList.toggle('hidden', state !== 'content');
        };

        const setLookupButtonLoading = (isLoading) => {
             ui.lookup.button.disabled = isLoading;
             ui.lookup.spinner.classList.toggle('hidden', !isLoading);
             ui.lookup.icon.classList.toggle('hidden', isLoading);
             ui.lookup.text.textContent = isLoading ? 'Looking up...' : 'Lookup';
        };

        // --- API Calls ---
        const fetchIpData = async (query) => {
            const isDomain = !/^\d{1,3}(\.\d{1,3}){3}$/.test(query) && query.includes('.');
            let targetQuery = query;

            // Simple validation before DNS lookup
            if (!query && !isDomain) {
                // Fetch user's IP if query is empty
            } else if (!isDomain && !/^\d{1,3}(\.\d{1,3}){3}$/.test(query)) {
                // Basic check if it's not empty, not domain, but not IP either
                throw new Error("Invalid IP address format.");
            } else if (isDomain && !/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/.test(query)) {
                 // Basic domain format check
                 throw new Error("Invalid domain name format.");
            }


             if (isDomain && query) {
                try {
                    const dnsResponse = await fetch(`https://dns.google/resolve?name=${encodeURIComponent(query)}&type=A`);
                    if (!dnsResponse.ok) throw new Error(`DNS resolution failed (${dnsResponse.status})`);
                    const dnsData = await dnsResponse.json();
                    if (dnsData.Answer && dnsData.Answer.length > 0) {
                        targetQuery = dnsData.Answer[0].data; // Use the first resolved A record IP
                         console.log(`Resolved ${query} to ${targetQuery}`);
                    } else {
                        // If DNS resolution fails specifically, throw a clearer error
                        throw new Error(`Could not resolve domain '${query}' to an IP address.`);
                    }
                } catch (e) {
                    console.error("DNS resolution error:", e);
                    throw e; // Re-throw to be caught by the main handler
                }
            }

            const url = `https://ipwho.is/${targetQuery || ''}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    let errorMsg = `IP lookup failed (Status: ${response.status})`;
                    try {
                        const errorData = await response.json();
                        errorMsg = errorData.message || errorMsg;
                    } catch(_) { /* Ignore parse error */ }
                    throw new Error(errorMsg);
                }
                const data = await response.json();

                if (data.success === false) {
                    throw new Error(data.message || 'Invalid IP or lookup failed');
                }

                if (isDomain && query) {
                    data.original_query = query;
                    if (!data.ip) data.ip = targetQuery;
                } else if (!data.ip) {
                     throw new Error('API did not return an IP address.');
                }

                return data;
            } catch (error) {
                console.error('IPWhois fetch error:', error);
                throw error;
            }
        };


        const fetchWhoisData = async (domain) => {
            const apiUrl = `/api/whois?domain=${encodeURIComponent(domain)}`;
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    let errorMsg = `WHOIS Error: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMsg = errorData.error || errorData.message || `Server responded with status ${response.status}`;
                    } catch (parseError) {
                         errorMsg = `Server error: ${response.status} ${response.statusText}`;
                    }
                    throw new Error(errorMsg);
                }
                const data = await response.json();
                 return {
                    registrar: data.registrar || 'N/A',
                    creation_date: data.creation_date || 'N/A',
                    expiration_date: data.expiration_date || 'N/A',
                };
            } catch (error) {
                console.error("Frontend WHOIS fetch error:", error);
                return { registrar: `Error: ${error.message}`, creation_date: 'N/A', expiration_date: 'N/A' };
            }
        };

        // --- Fetch DNS Data (unchanged) ---
        const fetchDnsData = async (domain) => {
             const recordTypes = ['A', 'AAAA', 'MX', 'TXT', 'NS'];
             const dnsApiBase = 'https://dns.google/resolve?name=';
             const promises = recordTypes.map(async (type) => {
                 try {
                     const response = await fetch(`${dnsApiBase}${encodeURIComponent(domain)}&type=${type}`);
                     if (!response.ok) return { type, records: [] };
                     const data = await response.json();
                     const records = data.Answer ? data.Answer.map(ans => {
                         if (type === 'MX') {
                             const parts = ans.data.split(' '); return `${parts[0]} ${parts[1]}`;
                         }
                         if (type === 'TXT') { return ans.data.replace(/"/g, ''); }
                         return ans.data;
                     }) : [];
                     return { type, records };
                 } catch (e) {
                     console.error(`DNS fetch error for ${type}:`, e);
                     return { type, records: [] };
                 }
             });
             const results = await Promise.all(promises);
             const dnsData = {};
             results.forEach(result => {
                 if (result.records.length > 0) { dnsData[result.type] = result.records; }
             });
             return dnsData;
        };


        // --- Rendering ---
        const renderMyIp = (data) => {
            if (!data) return;
            ui.myIp.address.textContent = data.ip || 'Error';
            ui.myIp.location.textContent = data.success ? `${data.city || ''}, ${data.region || ''}, ${data.country_code || ''}` : 'Location unavailable';
            showMyIpLoading(false);
        };

        const renderResults = (data, isDomain) => {
            if (!data || !data.success) {
                showResultState('error');
                ui.results.errorMessage.textContent = data?.message || 'Failed to load IP data.';
                return;
            };

            ui.results.tabWhois.classList.toggle('hidden', !isDomain);
            ui.results.tabDns.classList.toggle('hidden', !isDomain);

            const n_a = 'N/A';
            const conn = data.connection || {};
            const sec = data.security || {};
            const tz = data.timezone || {};

            // --- Geolocation ---
            const displayQuery = data.original_query ? `${data.original_query} (${data.ip})` : data.ip;
            ui.res.query.textContent = displayQuery || n_a;
            ui.res.country.textContent = data.country ? `${data.country} (${data.country_code || 'N/A'})` : n_a;
            ui.res.region.textContent = data.region || n_a;
            ui.res.city.textContent = data.city || n_a;
            ui.res.zip.textContent = data.postal || n_a;
            ui.res.lat.textContent = data.latitude || n_a;
            ui.res.lon.textContent = data.longitude || n_a;

            // --- Network ---
            ui.res.isp.textContent = conn.isp || n_a;
            ui.res.org.textContent = conn.org || n_a;
            ui.res.as.textContent = conn.asn ? `AS${conn.asn}` : n_a; // Format ASN
            ui.res.hostname.textContent = conn.domain || n_a; // Use 'domain' from connection

            // --- Security ---
            const securityItems = ['proxy', 'vpn', 'tor'];
            securityItems.forEach(item => {
                const key = `is_${item}`; // e.g., is_proxy
                const element = ui.res[item];
                const value = sec[key]; // true, false, or undefined

                element.textContent = typeof value === 'boolean' ? (value ? 'Yes' : 'No') : n_a;
                // Clear previous color classes before adding new one
                element.parentElement.classList.remove('text-red-500', 'text-green-500', 'text-gray-500');
                if (typeof value === 'boolean') {
                    element.parentElement.classList.add(value ? 'text-red-500' : 'text-green-500');
                } else {
                    element.parentElement.classList.add('text-gray-500'); // Default color for N/A
                }
            });

            // --- Timezone ---
            ui.res.timezone.textContent = tz.id || n_a;
            let localTimeText = n_a;
            try {
                 // Prefer current_time from API if available and looks valid
                 if (tz.current_time && tz.current_time.length > 10) { // Basic check
                    const date = new Date(tz.current_time);
                    // Check if date is valid after parsing
                    if (!isNaN(date.getTime())) {
                        localTimeText = date.toLocaleString("en-US", { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true, timeZoneName: 'short' });
                    }
                 }
                 // Fallback: Calculate using timezone ID if current_time failed or missing
                 if (localTimeText === n_a && tz.id) {
                     localTimeText = new Date().toLocaleString("en-US", { timeZone: tz.id, hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true, timeZoneName: 'short' });
                 }
            } catch (e) {
                console.error("Error formatting time:", e);
                localTimeText = 'Invalid Time Data';
            }
            ui.res.localtime.textContent = localTimeText;


            // --- Update Map ---
            ui.map.placeholder.classList.add('hidden'); // Hide placeholder initially
            if (map && data.latitude && data.longitude) {
                try {
                    const latLon = [data.latitude, data.longitude];
                    const popupText = `${data.city || 'Location'}, ${data.country || ''}<br>ISP: ${conn.isp || n_a}`;
                    map.flyTo(latLon, 10, { animate: true, duration: 0.5 });
                    if (mapMarker) {
                        mapMarker.setLatLng(latLon).setPopupContent(popupText);
                    } else {
                        mapMarker = L.marker(latLon).addTo(map).bindPopup(popupText);
                    }
                    setTimeout(() => { if (!map.panAnim) mapMarker.openPopup(); }, 600);
                } catch(e) {
                     console.error("Map update error:", e);
                     ui.map.placeholder.classList.remove('hidden'); // Show placeholder on map error
                     ui.map.placeholder.textContent = 'Error displaying map data.';
                }
            } else {
                 ui.map.placeholder.textContent = 'Geolocation data unavailable for map.';
                 ui.map.placeholder.classList.remove('hidden'); // Show placeholder if no lat/lon
            }

            // Render Lucide icons for copy buttons etc.
             if (window.lucide) {
                lucide.createIcons();
             }

            showResultState('content');
            switchTab(ui.results.tabs[0]); // Reset to first tab
        };


        const renderWhoisResults = (data) => {
             if (!data) return;
             const n_a = 'N/A';
             ui.res.whoisRegistrar.textContent = data.registrar || n_a;
             // Add date formatting
             try { ui.res.whoisRegistered.textContent = data.creation_date ? new Date(data.creation_date).toLocaleDateString() : n_a; } catch { ui.res.whoisRegistered.textContent = 'Invalid Date'; }
             try { ui.res.whoisExpires.textContent = data.expiration_date ? new Date(data.expiration_date).toLocaleDateString() : n_a; } catch { ui.res.whoisExpires.textContent = 'Invalid Date'; }
        };

        const renderDnsResults = (data) => {
            ui.results.panelDns.innerHTML = ''; // Clear previous results
            if (!data || Object.keys(data).length === 0) {
                ui.results.panelDns.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No common DNS records found.</p>';
                return;
            }
            let html = '';
            const recordTypes = ['A', 'AAAA', 'MX', 'TXT', 'NS'];
            recordTypes.forEach(type => {
                if (data[type] && data[type].length > 0) {
                    html += `<div class="dns-record-group"><h4>${type} Records</h4><ul class="dns-record-list">`;
                    data[type].forEach(record => {
                        // Basic escaping for safety
                        const safeRecord = record.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                        html += `<li>${safeRecord}</li>`;
                    });
                    html += `</ul></div>`;
                }
            });
            if (html === '') {
                html = '<p class="text-gray-500 dark:text-gray-400">No common DNS records (A, AAAA, MX, TXT, NS) found.</p>';
            }
            ui.results.panelDns.innerHTML = html;
        };


        // --- Event Handlers ---
        const handleLookup = async () => {
            const query = ui.lookup.input.value.trim();
             ui.lookup.inputError.classList.add('hidden'); // Hide previous errors
            if (!query) {
                return;
            }

            setLookupButtonLoading(true); // Show loading state
            showResultState('loading');
            ui.map.placeholder.textContent = 'Loading map data...'; // Update map placeholder
            ui.map.placeholder.classList.remove('hidden');

            const isDomain = !/^\d{1,3}(\.\d{1,3}){3}$/.test(query) && query.includes('.');

            try {
                const ipData = await fetchIpData(query);
                renderResults(ipData, isDomain);

                if (isDomain && ipData.success) {
                     const originalDomainQuery = ipData.original_query || query; // Use the stored original query
                    const [dnsData, whoisData] = await Promise.all([
                        fetchDnsData(originalDomainQuery).catch(e => { console.error("DNS fetch failed:", e); return null; }), // Add catch to individual promises
                        fetchWhoisData(originalDomainQuery).catch(e => { console.error("WHOIS fetch failed:", e); return null; })
                    ]);
                    renderDnsResults(dnsData);
                    renderWhoisResults(whoisData);
                } else if (!isDomain) {
                    renderDnsResults(null);
                    renderWhoisResults(null);
                }

            } catch (error) {
                console.error('Lookup failed:', error);
                showResultState('error');
                ui.results.errorMessage.textContent = error.message || 'An unknown error occurred during lookup.';
                ui.map.placeholder.textContent = 'Lookup failed, map unavailable.'; // Update map placeholder on error
                ui.map.placeholder.classList.remove('hidden');
            } finally {
                setLookupButtonLoading(false); // Hide loading state regardless of outcome
            }
        };


        const switchTab = (tab) => {
            if (!tab) return;
            document.querySelectorAll('[role="tab"]').forEach(t => t.setAttribute('aria-selected', 'false'));
            // Select the clicked tab
            tab.setAttribute('aria-selected', 'true');

            document.querySelectorAll('[role="tabpanel"]').forEach(p => p.classList.add('hidden'));

            // Show the target panel
            const panelId = tab.getAttribute('aria-controls');
            const targetPanel = document.getElementById(panelId);
            if (targetPanel) {
                targetPanel.classList.remove('hidden');
            } else {
                 console.warn(`Panel with ID ${panelId} not found.`);
            }
        };


        const handleCopyClick = (e) => {
            const copyButton = e.target.closest('.copy-btn');
            if (!copyButton) return;
            const textElement = copyButton.previousElementSibling; // Get the <span> before the button
            if (!textElement) return;
            const textToCopy = textElement.textContent;
            if (!textToCopy || textToCopy === 'N/A') return;

            const copySuccess = () => {
                const originalIconHTML = '<i data-lucide="copy" class="w-4 h-4"></i>';
                const successIconHTML = '<i data-lucide="check" class="w-4 h-4 text-emerald-500"></i>';
                copyButton.innerHTML = successIconHTML;
                if (window.lucide) lucide.createIcons(); // Re-render icon
                setTimeout(() => {
                    copyButton.innerHTML = originalIconHTML;
                    if (window.lucide) lucide.createIcons(); // Re-render icon
                }, 1500);
            };

            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(textToCopy)
                    .then(copySuccess)
                    .catch(err => console.error('Copy failed:', err));
            } else {
                // Basic fallback
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                textArea.style.position = "fixed"; textArea.style.top = "-9999px"; textArea.style.left = "-9999px";
                document.body.appendChild(textArea);
                textArea.select();
                try { document.execCommand('copy'); copySuccess(); }
                catch (err) { console.error('Fallback copy failed:', err); }
                document.body.removeChild(textArea);
            }
        };


        const initialize = async () => {
            showMyIpLoading(true);
            showResultState('placeholder'); // Start with placeholder
            ui.map.placeholder.classList.remove('hidden'); // Show map placeholder initially

            try {
                const myIpData = await fetchIpData(''); // Fetch user's IP
                renderMyIp(myIpData);
                renderResults(myIpData, false); // Render initial results for user's IP
            } catch (error) {
                showMyIpLoading(false);
                ui.myIp.address.textContent = 'Error';
                ui.myIp.location.textContent = 'Could not fetch your IP.';
                showResultState('error');
                ui.results.errorMessage.textContent = error.message || "Could not fetch your IP details.";
                ui.map.placeholder.textContent = 'Could not fetch IP, map unavailable.';
                ui.map.placeholder.classList.remove('hidden');
            }

            // Add event listeners AFTER elements are potentially updated
            ui.lookup.button.addEventListener('click', handleLookup);
            ui.lookup.input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent potential form submission if wrapped in form
                    handleLookup();
                }
            });

            document.querySelectorAll('[role="tab"]').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab));
            });

            ui.results.card.addEventListener('click', handleCopyClick);

             // Make sure Lucide icons are rendered after initial content is potentially added
             if (window.lucide) {
                lucide.createIcons();
             }
        };

        // Call initialize now that it's defined
        initialize();
        // --- End of Fix ---

    }); // End DOMContentLoaded listener
    </script>
</body>
</html>

